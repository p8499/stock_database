/**
     * ID: std1
     * Description: Stock market data - daily
     */
CREATE VIEW VM11 AS SELECT 
/*ID*/ t0.D1ID D1ID , 
/*证券代码*/ t0.D1STID D1STID , 
/*交易日*/ t0.D1DATE D1DATE , 
/*开盘价*/ t0.D1OPEN D1OPEN , 
/*收盘价*/ t0.D1CLOSE D1CLOSE , 
/*最高价*/ t0.D1HIGH D1HIGH , 
/*最低价*/ t0.D1LOW D1LOW , 
/*成交量*/ t0.D1VOLUME D1VOLUME , 
/*成交额*/ t0.D1AMOUNT D1AMOUNT , 
/*总股本*/ t0.D1TOTALSHARE D1TOTALSHARE , 
/*流通股本*/ t0.D1FLOWSHARE D1FLOWSHARE , 
/*复权因子*/ t0.D1FACTOR D1FACTOR , 
/*小单买入量*/ t0.D1BUY1 D1BUY1 , 
/*小单卖出量*/ t0.D1SELL1 D1SELL1 , 
/*中单买入量*/ t0.D1BUY2 D1BUY2 , 
/*中单卖出量*/ t0.D1SELL2 D1SELL2 , 
/*大单买入量*/ t0.D1BUY3 D1BUY3 , 
/*大单卖出量*/ t0.D1SELL3 D1SELL3 , 
/*超大单买入量*/ t0.D1BUY4 D1BUY4 , 
/*超大单卖出量*/ t0.D1SELL4 D1SELL4 , 
/*开盘价(前复权)*/ t0.D1OPEN * t0.D1FACTOR / t2.D1FACTOR D1OPENPRE , 
/*收盘价(前复权)*/ t0.D1CLOSE * t0.D1FACTOR / t2.D1FACTOR D1CLOSEPRE , 
/*最高价(前复权)*/ t0.D1HIGH * t0.D1FACTOR / t2.D1FACTOR D1HIGHPRE , 
/*最低价(前复权)*/ t0.D1LOW * t0.D1FACTOR / t2.D1FACTOR D1LOWPRE , 
/*成交量(前复权)*/ t0.D1VOLUME * t0.D1FACTOR / t2.D1FACTOR D1VOLUMEPRE , 
/*开盘价(后复权)*/ t0.D1OPEN * t0.D1FACTOR / t1.D1FACTOR D1OPENPOST , 
/*收盘价(后复权)*/ t0.D1CLOSE * t0.D1FACTOR / t1.D1FACTOR D1CLOSEPOST , 
/*最高价(后复权)*/ t0.D1HIGH * t0.D1FACTOR / t1.D1FACTOR D1HIGHPOST , 
/*最低价(后复权)*/ t0.D1LOW * t0.D1FACTOR / t1.D1FACTOR D1LOWPOST , 
/*成交量(后复权)*/ t0.D1VOLUME * t0.D1FACTOR / t1.D1FACTOR D1VOLUMEPOST , 
/*换手*/ t0.D1VOLUME / t0.D1FLOWSHARE D1TURNOVER , 
/*中单起净买占比*/ (t0.D1BUY2 - t0.D1SELL2 + t0.D1BUY3 - t0.D1SELL3 + t0.D1BUY4 - t0.D1SELL4) / t0.D1VOLUME D1NETPERCENT2 , 
/*大单起净买占比*/ (t0.D1BUY3 - t0.D1SELL3 + t0.D1BUY4 - t0.D1SELL4) / t0.D1VOLUME D1NETPERCENT3 , 
/*超大单起净买占比*/ (t0.D1BUY4 - t0.D1SELL4) / t0.D1VOLUME D1NETPERCENT4 , 
/*中单起净买力度*/ (t0.D1BUY2 - t0.D1SELL2 + t0.D1BUY3 - t0.D1SELL3 + t0.D1BUY4 - t0.D1SELL4) / t0.D1FLOWSHARE D1NETFORCE2 , 
/*大单起净买力度*/ (t0.D1BUY3 - t0.D1SELL3 + t0.D1BUY4 - t0.D1SELL4) / t0.D1FLOWSHARE D1NETFORCE3 , 
/*超大单起净买力度*/ (t0.D1BUY4 - t0.D1SELL4) / t0.D1FLOWSHARE D1NETFORCE4 , 
/*交易所ID*/ t3.STEXID D1EXID , 
/*交易所名称*/ t4.EXNAME D1EXNAME ,
/*股东权益合计（不含少数股东权益）*/ t0.D1FINA D1FINA , 
/*年化营业收入*/ t0.D1FIOIY D1FIOIY , 
/*年化净利润*/ t0.D1FINPEY D1FINPEY , 
/*年化经营活动产生的现金流量净额*/ t0.D1FIOCNY D1FIOCNY , 
/*每股净资产*/ t0.D1FINAPS D1FINAPS , 
/*每股营业收入*/ t0.D1FIOIYPS D1FIOIYPS , 
/*基本每股收益*/ t0.D1FINPEYPS D1FINPEYPS , 
/*每股经营活动产生的现金流量净额*/ t0.D1FIOCNYPS D1FIOCNYPS , 
/*动态市净率*/ t0.D1PB D1PB , 
/*动态市销率*/ t0.D1PS D1PS , 
/*动态市盈率*/ t0.D1PE D1PE , 
/*动态市现率*/ t0.D1PCF D1PCF FROM FM11 t0
LEFT JOIN (SELECT D1STID, D1FACTOR FROM FM11 t10 WHERE NOT EXISTS (SELECT 1 FROM FM11 t11 WHERE t11.D1STID = t10.D1STID AND t11.D1DATE < t10.D1DATE)) t1 ON t1.D1STID = t0.D1STID
LEFT JOIN (SELECT D1STID, D1FACTOR FROM FM11 t20 WHERE NOT EXISTS (SELECT 1 FROM FM11 t21 WHERE t21.D1STID = t20.D1STID AND t21.D1DATE > t20.D1DATE)) t2 ON t2.D1STID = t0.D1STID
LEFT JOIN FS11 t3 ON t3.STID = t0.D1STID
LEFT JOIN FS01 t4 ON t4.EXID = t3.STEXID;
